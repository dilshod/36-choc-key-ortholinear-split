# mcuboot build
git clone git@github.com:mcu-tools/mcuboot.git
west build -b nrf5340dk_nrf5340_cpuapp -- -DCONFIG_BOOT_SIGNATURE_KEY_FILE=\"/Users/dilshod/Projects/nrf5340/mykey.pem\"
west flash

# generate key file
python3 ~/kbd/mcuboot/scripts/imgtool.py keygen -k mykey.pem -t rsa-2048

~/kbd/zmk/app/env.sh:

export ZEPHYR_TOOLCHAIN_VARIANT=zephyr
export ZEPHYR_SDK_INSTALL_DIR=/Users/dilshod/zephyr/sdk/zephyr-sdk-0.16.5
export ZEPHYR_BASE=/Users/dilshod/kbd/zmk/zephyr
export SDKROOT=$(xcrun --sdk macosx --show-sdk-path)


Building:

source ~/kbd/zmk/app/env.sh

# Build split
west build -p -b nrf5340dk_nrf5340_cpuapp -d build/app_left ~/kbd/zmk/app -- -DSHIELD="nrf5340_left" -DZMK_CONFIG=/Users/dilshod/Projects/nrf5340/zmk-config/config -DCONFIG_MCUBOOT_SIGNATURE_KEY_FILE=\"/Users/dilshod/Projects/nrf5340/mykey.pem\"
west build -p -b nrf5340dk_nrf5340_cpuapp -d build/app_right ~/kbd/zmk/app -- -DSHIELD="nrf5340_right" -DZMK_CONFIG=/Users/dilshod/Projects/nrf5340/zmk-config/config -DCONFIG_MCUBOOT_SIGNATURE_KEY_FILE=\"/Users/dilshod/Projects/nrf5340/mykey.pem\"
west build -p -b nrf5340dk_nrf5340_cpunet -d build/net ~/kbd/zmk/zephyr/samples/bluetooth/hci_rpmsg/ -- -DCONFIG_LOG="n" -DCONFIG_CONSOLE="n" -DCONFIG_SERIAL="n" -DCONFIG_UART_CONSOLE="n"

# Flash
dfu-util -a 1 --download build/app_left/zephyr/zmk.signed.bin
